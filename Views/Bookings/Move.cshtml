@model PassItOnAcademy.Models.Booking
@{
    ViewData["Title"] = "Move Booking";
    var candidates = ViewBag.Candidates as IEnumerable<dynamic>; // from controller
}

<div class="space-y-6">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight">Move Booking #@Model.Id</h1>
            <p class="text-sm text-zinc-500">Pick a new session with available capacity.</p>
        </div>
        <a asp-action="Details" asp-route-id="@Model.Id" class="rounded-lg border border-zinc-300 px-3 py-1.5 text-sm hover:bg-zinc-50">Back</a>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Current session -->
        <div class="rounded-2xl border border-zinc-200 bg-white p-6 shadow-sm">
            <h2 class="text-sm font-semibold">Current Session</h2>
            <div class="mt-3 space-y-1 text-sm">
                <div class="font-medium">@Model.Session?.Title</div>
                <div class="text-zinc-600">ID: @Model.SessionId · @Model.Session?.Level</div>
                @if (Model.Session != null)
                {
                    var local = Model.Session.StartUtc.ToLocalTime();
                    <div class="text-zinc-600">@local.ToString("yyyy-MM-dd HH:mm")</div>
                    <div class="text-zinc-600">Location: @Model.Session.Location</div>
                }
            </div>
        </div>

        <!-- Candidates list -->
        <div class="lg:col-span-2 rounded-2xl border border-zinc-200 bg-white p-6 shadow-sm">
            <h2 class="text-sm font-semibold">Available Sessions</h2>

            @if (candidates == null || !candidates.Any())
            {
                <div class="mt-3 text-sm text-zinc-600">No suitable sessions found.</div>
            }
            else
            {
                <form asp-action="Move" method="post" class="mt-4 space-y-4">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="id" value="@Model.Id" />

                    <div class="space-y-3 max-h-[60vh] overflow-auto pr-1">
                        @foreach (var c in candidates)
                        {
                            // dynamic fields: Id, Title, Level, StartUtc, Capacity, Booked
                            var dt = ((DateTime)c.StartUtc).ToLocalTime();
                            var left = (int)c.Capacity - (int)c.Booked;
                            <label class="flex w-full items-start gap-3 rounded-xl border border-zinc-200 p-4 hover:bg-zinc-50">
                                <input type="radio" name="targetSessionId" value="@c.Id" class="mt-1 h-4 w-4 text-black focus:ring-[#FFD200]" required />
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <div class="font-semibold">@c.Title</div>
                                        <div class="text-xs text-zinc-600">Spots left: <span class="font-semibold">@left</span></div>
                                    </div>
                                    <div class="mt-1 text-xs text-zinc-600">Level: @c.Level</div>
                                    <div class="text-xs text-zinc-600">@dt.ToString("yyyy-MM-dd HH:mm")</div>
                                </div>
                            </label>
                        }
                    </div>

                    <div class="flex items-center gap-3 pt-2">
                        <a asp-action="Details" asp-route-id="@Model.Id" class="rounded-lg border border-zinc-300 px-4 py-2 text-sm hover:bg-zinc-50">Cancel</a>
                        <button type="submit" class="rounded-xl bg-black px-5 py-2.5 text-sm font-semibold text-white hover:bg-zinc-900">
                            Move booking
                        </button>
                    </div>
                </form>
            }
        </div>
    </div>
</div>
